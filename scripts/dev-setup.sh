#!/bin/bash

echo "üöÄ ChildDev Development Setup"
echo "=============================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –º—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -f "README.md" ]; then
    echo "‚ùå –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–æ–≤ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
echo "üìÑ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."

if [ ! -f ".env.local" ]; then
    cp infra/env/.env.local.example .env.local
    echo "‚úÖ –°–æ–∑–¥–∞–Ω .env.local"
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –ª–æ–≥–æ–≤
mkdir -p logs
echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ logs"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Web —Å–µ—Ä–≤–∏—Å–∞
echo "üåê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Web —Å–µ—Ä–≤–∏—Å–∞..."
cd services/web
if [ ! -d "node_modules" ]; then
    npm install
    echo "‚úÖ Web dependencies —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "‚úÖ Web dependencies —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π PDF —Å–µ—Ä–≤–∏—Å–∞  
echo "üìÑ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π PDF —Å–µ—Ä–≤–∏—Å–∞..."
cd ../pdf
if [ ! -d "node_modules" ]; then
    npm install
    echo "‚úÖ PDF dependencies —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤ –¥–ª—è Playwright
    echo "üé≠ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤ Playwright..."
    npx playwright install chromium
    echo "‚úÖ Playwright –±—Ä–∞—É–∑–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
else
    echo "‚úÖ PDF dependencies —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi

cd ../..

echo ""
echo "üéâ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. ./scripts/run-local.sh  - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã"
echo "2. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000 –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
echo ""